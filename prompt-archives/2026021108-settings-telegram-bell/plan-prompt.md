# Prompt Archive

时间：2026-02-11
目录：2026021108-settings-telegram-bell

## 用户需求（原始）

做如下改进：
1. 新增设置页：
1.1 支持调整站点名称，即标题栏和sidebar上的tmex字样
1.2 支持设置站点访问URL用于给bot发的消息拼的字符串
1.3 支持设置多个telegram bot key，对于每个bot，支持最多8个授权的chat（已授权+待授权），授权需要在网页中选择批准或拒绝（拒绝即删除），列表中要显示申请时间、chat id、人名/群组名，对于已授权的chat显示测试消息按钮和撤销授权按钮
2. 所有错误提示应该使用 shadcn 的sonner展示
3. ssh连接失败会导致整个gateway退出，需要改进
4. 对于tmux终端中传来的bell，网页中需要使用sonner展示，点击sooner toast可跳转去对应的pane，同时需要给所有授权的bot chat发送通知，通知中包括 device window panel 站点名 等信息，同时包含直达pane的链接

## 后续澄清

1. Telegram 授权来源使用轮询 `getUpdates`。
2. 授权关系按 bot 独立。
3. 站点配置存数据库并可网页修改。
4. bell 频控做成设置项，默认 6 秒。
5. SSH 失败改为自动重连，新增重连次数与等待时间设置，默认 2 次 / 10 秒。
6. Telegram bot 功能优先使用 `gramio`。
7. 每个 bot 增加“允许申请授权”开关。
8. 设置页提供“重启 Gateway”按钮，重启语义为主循环平滑停副作用后自拉起。
9. 站点名全站统一替换。
10. 密码鉴权和相关代码可完全删除，默认内网部署。

## 执行指令

Implement the plan.

## 新增问题反馈（滚动与入口）

1. 设置界面不能滚动，不能正常使用。
2. 设备管理首页入口体验被改坏，要求原样加回。
3. 明确要求：设备列表页也必须支持滚动。

## 本轮确认

1. 滚动范围：`/devices` 与 `/settings` 可滚动。
2. 终端页（`/devices/:deviceId/windows/:windowId/panes/:paneId`）保持不滚动。
3. 侧边栏底部入口改为双入口并列：`管理设备` + `设置`。

## 新增问题反馈（输入草稿/设备编辑）

1. 输入框中未发送的内容应该缓存，无论是页面刷新还是页面切换，里面的内容都不应该丢失。
2. 页面切换会报错 `当前 Pane 已关闭，请在侧边栏重新选择 Pane。`，不影响使用但是干扰体验。
3. 管理设备和设置两个按钮应该单独成行，不要挤在同一行。
4. 设备管理应支持修改设备。
5. 添加/修改本地设备时应隐藏认证方式相关输入项。

## 本轮执行指令

Implement the plan.
